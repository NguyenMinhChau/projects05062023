<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Pay Wifi TVU - FPT Telecom</title>
		<link
			rel="icon"
			href="https://${IP_HOST_SERVER}${BASE_PATH_API + STATIC_PATH_FOLDER}/favicon-16x16.png"
			type="image/png"
		/>
		<meta
			property="og:image"
			content="https://${IP_HOST_SERVER}${BASE_PATH_API + STATIC_PATH_FOLDER}/fpt-logo.png"
		/>
		<meta
			name="description"
			content="FPT Telecom - Pay Wifi Trường Đại Học Trà Vinh"
		/>
		<script
			type="text/javascript"
			src="https://${IP_HOST_SERVER}${BASE_PATH_API + STATIC_PATH_ASSETS_MODULE}/crypto4.0.0.min.js"
		></script>
	</head>
	<style>
		body,
		html {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			width: 100%;
			height: 100vh;
			display: flex;
			justify-content: center;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}

		body::-webkit-scrollbar {
			display: none;
		}

		.container {
			width: 450px;
			height: 100vh;
			background-color: #fff;
			background-image: url('https://${IP_HOST_SERVER}${BASE_PATH_API + STATIC_PATH_FOLDER}/pay-wifi.jpg');
			background-position: center;
			background-repeat: no-repeat;
			background-size: 100% 100%;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			box-sizing: border-box;
			gap: 10px;
		}

		.container-top {
			width: 100%;
		}

		.container-bottom {
			width: 100%;
			box-sizing: border-box;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: flex-start;
			gap: 15px;
			padding-bottom: 20%;
		}

		.container-bottom input {
			width: 70%;
			height: 50px;
			border-radius: 6px;
			border: none;
			outline: none;
			padding: 0 12px;
			font-size: 26px;
			box-sizing: border-box;
			text-align: center;
		}

		.container-bottom input::-webkit-input-placeholder {
			color: #000;
			font-size: 20px;
			font-weight: bold;
			text-align: center;
		}

		.btn_container .btn {
			width: max-content;
			border-radius: 6px;
			padding: 8px 12px;
			border: none;
			outline: none;
			background-color: #e3e608;
			font-size: 16px;
			font-weight: bold;
			cursor: pointer;
			font-weight: bold;
			text-align: center;
			margin-top: 12px;
		}

		.modal-loading {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100vh;
			background-color: rgba(0, 0, 0, 0.2);
			z-index: 999;
			display: none;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 12px;
			box-sizing: border-box;
		}

		.modal-content {
			background-color: rgba(255, 255, 255, 0.9);
			border-radius: 15px;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 10px;
			box-sizing: border-box;
		}

		@-webkit-keyframes dots-fade {
			0% {
				background: #2d7cd4;
				opacity: 0;
				-webkit-transform: translateX(-175%);
				transform: translateX(-175%);
			}
			10% {
				opacity: 1;
				-webkit-transform: translateX(-175%);
				transform: translateX(-175%);
			}
			20% {
				background: #2d7cd4;
				opacity: 0;
				-webkit-transform: translateX(-175%);
				transform: translateX(-175%);
			}
			30% {
				opacity: 0;
				-webkit-transform: translateX(0);
				transform: translateX(0);
			}
			40% {
				opacity: 1;
				-webkit-transform: translateX(0);
				transform: translateX(0);
			}
			50% {
				background: #2d7cd4;
				opacity: 0;
				-webkit-transform: translateX(0);
				transform: translateX(0);
			}
			60% {
				background-color: #2d7cd4;
				opacity: 0;
				-webkit-transform: translateX(175%);
				transform: translateX(175%);
			}
			70% {
				opacity: 1;
				-webkit-transform: translateX(175%);
				transform: translateX(175%);
			}
			80%,
			100% {
				opacity: 0;
				-webkit-transform: translateX(175%);
				transform: translateX(175%);
			}
		}
		@keyframes dots-fade {
			0% {
				background: #2d7cd4;
				opacity: 0;
				-webkit-transform: translateX(-175%);
				transform: translateX(-175%);
			}
			10% {
				opacity: 1;
				-webkit-transform: translateX(-175%);
				transform: translateX(-175%);
			}
			20% {
				background: #2d7cd4;
				opacity: 0;
				-webkit-transform: translateX(-175%);
				transform: translateX(-175%);
			}
			30% {
				opacity: 0;
				-webkit-transform: translateX(0);
				transform: translateX(0);
			}
			40% {
				opacity: 1;
				-webkit-transform: translateX(0);
				transform: translateX(0);
			}
			50% {
				background: #2d7cd4;
				opacity: 0;
				-webkit-transform: translateX(0);
				transform: translateX(0);
			}
			60% {
				background-color: #2d7cd4;
				opacity: 0;
				-webkit-transform: translateX(175%);
				transform: translateX(175%);
			}
			70% {
				opacity: 1;
				-webkit-transform: translateX(175%);
				transform: translateX(175%);
			}
			80%,
			100% {
				opacity: 0;
				-webkit-transform: translateX(175%);
				transform: translateX(175%);
			}
		}

		.dots-fade:before {
			-webkit-animation: dots-fade 2s infinite;
			animation: dots-fade 2s infinite;
			background-color: #2d7cd4;
			border-radius: 100%;
			content: '';
			display: block;
			height: 10px;
			width: 10px;
		}

		/* Styles for PC/Desktop */
		@media (min-width: 1024px) {
			.container {
				width: 530px;
			}

			.container-bottom input {
				height: 30px;
				font-size: 16px;
			}

			.container-bottom input::-webkit-input-placeholder {
				font-size: 11px;
			}

			.btn_container .btn {
				width: max-content;
				font-size: 12px;
			}
		}

		/* Styles for Tablets */
		@media (min-width: 768px) and (max-width: 1023px) {
			.container {
				width: 600px;
			}
			.container-bottom input {
				font-size: 20px;
			}
			.container-bottom input::-webkit-input-placeholder {
				font-size: 16px;
			}
		}

		/* Styles for Mobile */
		@media (max-width: 767px) {
			.container {
				width: 100%;
			}

			.container-bottom input {
				height: 35px;
				font-size: 17px;
			}

			.container-bottom input::-webkit-input-placeholder {
				font-size: 11px;
			}

			.btn_container .btn {
				width: max-content;
				font-size: 12px;
			}
		}
		.error_container {
			width: 70%;
			display: flex;
			align-items: flex-start;
			text-align: left;
		}
		.error_email,
		.error_code {
			color: red;
			font-size: 12px;
			text-align: left;
			display: none;
		}
		.email_error,
		.code_error {
			border: 1px solid red !important;
		}
	</style>

	<body>
		<div class="container" loading="lazy">
			<div class="container-top"></div>
			<div class="container-bottom">
				<input
					type="text"
					placeholder="VUI LÒNG NHẬP EMAIL"
					id="email"
				/>
				<div class="error_container">
					<span class="error_email">Vui lòng nhập email</span>
				</div>
				<input
					type="text"
					placeholder="VUI LÒNG NHẬP MÃ CODE"
					id="code"
				/>
				<div class="error_container">
					<span class="error_code">Vui lòng nhập mã code</span>
				</div>
				<div class="btn_container">
					<button id="button" class="btn">KẾT NỐI INTERNET</button>
				</div>
			</div>
		</div>

		<div class="modal-loading">
			<div class="modal-content">
				<img
					loading="lazy"
					src="https://${IP_HOST_SERVER}${BASE_PATH_API + STATIC_PATH_FOLDER}/fpt-logo.png"
					alt="logo"
					style="width: 100%; max-width: 100px; object-fit: contain"
				/>
				<div class="dots-fade"></div>
			</div>
		</div>

		<script async>
			const btnSubmitElement = document.getElementById('button');
			const modalLoading = document.querySelector('.modal-loading');
			const emailInputElement = document.getElementById('email');
			const codeInputElement = document.getElementById('code');

			// const urlParams = new URLSearchParams(window.location.search);

			//! HANDLE DISPLAY ERROR

			//! Call API get data info
			const fetchAPI = async ({
				body = {},
				method = 'POST',
				url,
				onSuccess = () => {},
				onError = () => {},
			}) => {
				await fetch(url, {
					method: method,
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(body),
				})
					.then((res) => res.json())
					.then((res) => {
						onSuccess(res);
					})
					.catch((err) => {
						onError(err);
					});
			};
			function paramsToObj(_string, _separator) {
				var _res = {},
					_arr = [],
					_tmp;
				try {
					var _arr = _string.split(_separator);
				} catch (e) {}

				for (var _i = 0; _i < _arr.length; _i++) {
					try {
						_tmp = _arr[_i].split('=');

						_res[_tmp[0]] = _tmp[1];
					} catch (e) {}
				}
				return _res;
			}
			function getNavUrl() {
				return window.location.search.replace('?', '');
			}
			const reDir = 'http://10.15.99.1:1999/login.php?';
			const welcome = 'http://fas.pwifi.cpe-lab.com:9988/v2/success.html';
			var para = getNavUrl();
			var _s = paramsToObj(location.search.slice(1), '&');
			var _decrypted, _dec_r;
			var key = '15101999';
			// function _submit() {
			// 	window.location = reDir + 'mac=' + _dec_r.clientmac + '&redirect=' + encodeURIComponent(welcome) + '&code=' + pass.value
			// }

			emailInputElement.addEventListener('change', (e) => {
				if (e.target.value) {
					emailInputElement.classList.remove('email_error');
					document.querySelector('.error_email').style.display =
						'none';
				}
			});

			codeInputElement.addEventListener('change', (e) => {
				if (e.target.value) {
					codeInputElement.classList.remove('code_error');
					document.querySelector('.error_code').style.display =
						'none';
				}
			});

			//! API submit
			btnSubmitElement.addEventListener('click', async (e) => {
				e.preventDefault();
				const email = emailInputElement.value;
				const code = codeInputElement.value;
				const body = {
					userAgent: window.navigator.userAgent,
					email: email,
					code: code,
					device_mac: 'Test Giao Dien',
					macAP: 'xxxxx123432',
				};
				if (!email || !code) {
					alert(
						'Xin Quý Khách Hàng vui lòng nhập đầy đủ thông tin trước khi nhấn KẾT NỐI INTERNET!',
					);
					if (!email) {
						emailInputElement.classList.add('email_error');
						document.querySelector('.error_email').style.display =
							'block';
						emailInputElement.focus();
					} else {
						codeInputElement.classList.add('code_error');
						document.querySelector('.error_code').style.display =
							'block';
						codeInputElement.focus();
					}
					return;
				}
				modalLoading.style.display = 'flex';
				if (_s['fas'] && _s['iv']) {
					key = CryptoJS.MD5(key).toString().slice(0, 32);
					console.log(_s);
					var atobFas = URL.createObjectURL(
						new Blob([_s['fas']], { type: 'text/plain' }),
					);

					_decrypted = CryptoJS.AES.decrypt(
						atobFas,
						CryptoJS.enc.Utf8.parse(key),
						{
							iv: CryptoJS.enc.Utf8.parse(_s['iv']),
							mode: CryptoJS.mode.CBC,
							padding: CryptoJS.pad.Pkcs7,
						},
					);
					_dec_r = paramsToObj(
						_decrypted.toString(CryptoJS.enc.Utf8),
						', ',
					);
					console.log(
						reDir +
							'mac=' +
							_dec_r.clientmac +
							'&redirect=' +
							encodeURIComponent(welcome) +
							'&code=' +
							code,
					);
					window.location =
						reDir +
						'mac=' +
						_dec_r.clientmac +
						'&redirect=' +
						encodeURIComponent(welcome) +
						'&code=' +
						code;
				}

				await fetchAPI({
					url: 'https://${IP_HOST_SERVER + BASE_PATH_API}/dh-tra-vinh/on-press-connect-internet',
					body: body,
					onSuccess: (res) => {
						modalLoading.style.display = 'none';
						// emailInputElement.value = '';
						// codeInputElement.value = '';
						if (!res.success) {
							alert(
								res?.errors[0]?.msg || res?.errors[0]?.message,
							);
						} else {
							alert('Kết nối Internet thành công!');
						}
					},
					onError: (err) => {
						modalLoading.style.display = 'none';
						alert('Kết nối thất bại!');
					},
				});
			});
		</script>
	</body>
</html>
